<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>YouTube ì•„ì´ì½˜ í…ŒìŠ¤íŠ¸</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f9f9f9;
        }
        
        .youtube-container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .title-container {
            margin-bottom: 20px;
            padding: 15px;
            background: #f8f8f8;
            border-radius: 4px;
        }
        
        h1 {
            margin: 0;
            color: #333;
            font-size: 24px;
        }
        
        .description {
            color: #666;
            margin-top: 10px;
        }
        
        .test-info {
            background: #e3f2fd;
            padding: 15px;
            border-radius: 4px;
            margin-top: 20px;
        }
        
        .test-info h3 {
            margin-top: 0;
            color: #1976d2;
        }
        
        .debug-info {
            background: #fff3cd;
            padding: 15px;
            border-radius: 4px;
            margin-top: 20px;
            border: 1px solid #ffeaa7;
        }
        
        .debug-info h3 {
            margin-top: 0;
            color: #856404;
        }
        
        .debug-info pre {
            background: #f8f9fa;
            padding: 10px;
            border-radius: 4px;
            overflow-x: auto;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <div class="youtube-container">
        <div class="title-container">
            <h1>YouTube ë™ì˜ìƒ ì œëª©ì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤</h1>
            <div class="description">ì´ í˜ì´ì§€ëŠ” YouTube ì•„ì´ì½˜ í…ŒìŠ¤íŠ¸ë¥¼ ìœ„í•œ ê²ƒì…ë‹ˆë‹¤.</div>
        </div>
        
        <div class="test-info">
            <h3>í…ŒìŠ¤íŠ¸ ì •ë³´</h3>
            <p>ì´ í˜ì´ì§€ëŠ” YouTubeì™€ ìœ ì‚¬í•œ êµ¬ì¡°ë¡œ ë§Œë“¤ì–´ì ¸ ìˆì–´ì„œ, TTS í™•ì¥ í”„ë¡œê·¸ë¨ì˜ YouTube ì•„ì´ì½˜ì´ ì œëª© ì˜¤ë¥¸ìª½ì— ë‚˜íƒ€ë‚˜ì•¼ í•©ë‹ˆë‹¤.</p>
            <p>ì•„ì´ì½˜ì´ ë³´ì´ì§€ ì•ŠëŠ”ë‹¤ë©´:</p>
            <ul>
                <li>ë¸Œë¼ìš°ì € ê°œë°œì ë„êµ¬ì˜ ì½˜ì†”ì„ í™•ì¸í•´ë³´ì„¸ìš”</li>
                <li>í˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨í•´ë³´ì„¸ìš”</li>
                <li>TTS í™•ì¥ í”„ë¡œê·¸ë¨ì´ í™œì„±í™”ë˜ì–´ ìˆëŠ”ì§€ í™•ì¸í•´ë³´ì„¸ìš”</li>
            </ul>
        </div>
        
        <div class="debug-info">
            <h3>ë””ë²„ê·¸ ì •ë³´</h3>
            <div id="debug-output">
                <p>ë””ë²„ê·¸ ì •ë³´ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤...</p>
            </div>
        </div>
    </div>

    <!-- TTS í™•ì¥ í”„ë¡œê·¸ë¨ ìŠ¤í¬ë¦½íŠ¸ ë¡œë“œ -->
    <script src="html-analyzer-common.js"></script>
    <script src="html-analyzer-sites.js"></script>
    <script src="perplexity-api.js"></script>
    <script src="tts.js"></script>

    <script>
        // ë””ë²„ê·¸ ì¶œë ¥ í•¨ìˆ˜
        function debugLog(message) {
            const debugOutput = document.getElementById('debug-output');
            const timestamp = new Date().toLocaleTimeString();
            debugOutput.innerHTML += `<p>[${timestamp}] ${message}</p>`;
            console.log(message);
        }
        
        debugLog('YouTube ì•„ì´ì½˜ í…ŒìŠ¤íŠ¸ í˜ì´ì§€ ë¡œë“œë¨');
        
        // Chrome API ëª¨í‚¹ (TTS í™•ì¥ í”„ë¡œê·¸ë¨ ì˜¤ë¥˜ ë°©ì§€)
        if (typeof chrome === 'undefined') {
            window.chrome = {
                runtime: {
                    onMessage: {
                        addListener: function() {}
                    },
                    sendMessage: function() {}
                },
                storage: {
                    sync: {
                        get: function(keys, callback) {
                            callback({});
                        },
                        set: function() {}
                    },
                    onChanged: {
                        addListener: function() {}
                    }
                }
            };
            debugLog('Chrome API ëª¨í‚¹ ì™„ë£Œ');
        }
        
        // YouTube ëª¨ë“œ ì‹œë®¬ë ˆì´ì…˜
        const originalLocation = window.location;
        const mockLocation = {
            hostname: 'youtube.com',
            pathname: '/watch',
            href: 'https://youtube.com/watch?v=test',
            origin: 'https://youtube.com',
            protocol: 'https:',
            host: 'youtube.com'
        };
        
        // location ì†ì„± ì˜¤ë²„ë¼ì´ë“œ
        try {
            Object.defineProperty(window, 'location', {
                get: function() {
                    return mockLocation;
                },
                configurable: true
            });
            debugLog('Location ì˜¤ë²„ë¼ì´ë“œ ì„±ê³µ');
        } catch (error) {
            debugLog('Location ì˜¤ë²„ë¼ì´ë“œ ì‹¤íŒ¨: ' + error.message);
        }
        
        debugLog('í˜„ì¬ URL: ' + window.location.href);
        debugLog('í˜„ì¬ hostname: ' + window.location.hostname);
        debugLog('í˜„ì¬ pathname: ' + window.location.pathname);
        
        // TTS ë§¤ë‹ˆì € ë¡œë“œ ëŒ€ê¸° ë° YouTube ëª¨ë“œ í™œì„±í™”
        function waitForTTSManager() {
            if (window.ttsManager) {
                debugLog('TTS ë§¤ë‹ˆì € ë°œê²¬, YouTube ëª¨ë“œ ê°•ì œ í™œì„±í™”');
                
                // isYouTubeMode í•¨ìˆ˜ë¥¼ í…ŒìŠ¤íŠ¸ìš©ìœ¼ë¡œ ì˜¤ë²„ë¼ì´ë“œ
                window.ttsManager.isYouTubeMode = function() {
                    debugLog('YouTube ëª¨ë“œ í™•ì¸: true');
                    return true;
                };
                
                // YouTube ëª¨ë“œ ì‹œì‘
                if (window.ttsManager.startYouTubeMode) {
                    debugLog('YouTube ëª¨ë“œ ì‹œì‘');
                    window.ttsManager.startYouTubeMode();
                }
            } else {
                debugLog('TTS ë§¤ë‹ˆì € ëŒ€ê¸° ì¤‘...');
                setTimeout(waitForTTSManager, 100);
            }
        }
        
        // TTS ë§¤ë‹ˆì € ë¡œë“œ ëŒ€ê¸° ì‹œì‘
        setTimeout(waitForTTSManager, 1000);
        
        // YouTube ì•„ì´ì½˜ ìƒì„± í•¨ìˆ˜
        function createYouTubeIcon() {
            debugLog('ğŸ¥ YouTube: ì•„ì´ì½˜ ìƒì„± í•¨ìˆ˜ ì‹œì‘');
            
            // ê¸°ì¡´ ì•„ì´ì½˜ ì œê±°
            const existingIcon = document.getElementById('youtube-perplexity-icon');
            if (existingIcon) {
                existingIcon.remove();
                debugLog('ê¸°ì¡´ ì•„ì´ì½˜ ì œê±°ë¨');
            }

            // ì œëª© ìš”ì†Œ ì°¾ê¸°
            const titleElement = document.querySelector('h1');
            debugLog('ì œëª© ìš”ì†Œ ë°œê²¬: ' + (titleElement ? 'ì„±ê³µ' : 'ì‹¤íŒ¨'));
            
            if (!titleElement) {
                debugLog('ì œëª© ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŒ');
                return;
            }

            const iconSize = 24;
            
            // YouTube ì•„ì´ì½˜ ìƒì„±
            const youtubeIcon = document.createElement('div');
            youtubeIcon.id = 'youtube-perplexity-icon';
            youtubeIcon.innerHTML = `
                <svg width="${iconSize}" height="${iconSize}" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <circle cx="12" cy="12" r="11" fill="#000000" opacity="0.9"/>
                    <path d="M8 6v12l10-6z" fill="#ffffff"/>
                </svg>
            `;
            
            // ìœ„ì¹˜ ì„¤ì • - ì œëª© í–‰ ì˜¤ë¥¸ìª½
            const rect = titleElement.getBoundingClientRect();
            
            youtubeIcon.style.cssText = `
                position: fixed !important;
                top: ${rect.top + (rect.height - iconSize) / 2}px !important;
                left: ${rect.right + 15}px !important;
                z-index: 100000 !important;
                opacity: 1 !important;
                pointer-events: auto !important;
                cursor: pointer !important;
                background: transparent !important;
                border-radius: 50% !important;
                width: ${iconSize}px !important;
                height: ${iconSize}px !important;
                display: flex !important;
                align-items: center !important;
                justify-content: center !important;
                transition: transform 0.2s ease, opacity 0.2s ease !important;
                box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2) !important;
            `;

            debugLog('ì œëª© ìš”ì†Œ ìœ„ì¹˜: ' + JSON.stringify({
                top: rect.top,
                left: rect.left,
                right: rect.right,
                width: rect.width,
                height: rect.height
            }));
            
            debugLog('ì•„ì´ì½˜ ìœ„ì¹˜ ì„¤ì •: top=' + (rect.top + (rect.height - iconSize) / 2) + 'px, left=' + (rect.right + 15) + 'px');

            // í´ë¦­ ì´ë²¤íŠ¸ ì„¤ì •
            youtubeIcon.addEventListener('click', (event) => {
                event.stopPropagation();
                debugLog('ğŸ¥ YouTube: ì•„ì´ì½˜ í´ë¦­ë¨');
                alert('YouTube ì•„ì´ì½˜ì´ í´ë¦­ë˜ì—ˆìŠµë‹ˆë‹¤!');
            });

            // í˜¸ë²„ íš¨ê³¼
            youtubeIcon.addEventListener('mouseenter', () => {
                youtubeIcon.style.transform = 'scale(1.2)';
                youtubeIcon.style.opacity = '1';
                debugLog('ì•„ì´ì½˜ í˜¸ë²„ íš¨ê³¼ ì ìš©');
            });

            youtubeIcon.addEventListener('mouseleave', () => {
                youtubeIcon.style.transform = 'scale(1.0)';
                youtubeIcon.style.opacity = '0.9';
            });

            document.body.appendChild(youtubeIcon);
            debugLog('ğŸ¥ YouTube: Perplexity ì•„ì´ì½˜ ìƒì„± ì™„ë£Œ');
            debugLog('ì•„ì´ì½˜ì´ DOMì— ì¶”ê°€ë¨: ' + document.body.contains(youtubeIcon));
            
            // ì•„ì´ì½˜ ìŠ¤íƒ€ì¼ í™•ì¸
            setTimeout(() => {
                const computedStyle = window.getComputedStyle(youtubeIcon);
                debugLog('ì•„ì´ì½˜ ê³„ì‚°ëœ ìŠ¤íƒ€ì¼: ' + JSON.stringify({
                    display: computedStyle.display,
                    visibility: computedStyle.visibility,
                    opacity: computedStyle.opacity,
                    zIndex: computedStyle.zIndex,
                    position: computedStyle.position,
                    top: computedStyle.top,
                    left: computedStyle.left
                }));
            }, 100);
        }
        
        // í˜ì´ì§€ ë¡œë“œ í›„ ì•„ì´ì½˜ ìƒì„±
        setTimeout(() => {
            debugLog('ì²« ë²ˆì§¸ ì•„ì´ì½˜ ìƒì„± ì‹œë„');
            createYouTubeIcon();
        }, 500);
        
        // ì¶”ê°€ë¡œ 2ì´ˆ í›„ì—ë„ í•œ ë²ˆ ë” ì‹œë„
        setTimeout(() => {
            debugLog('ë‘ ë²ˆì§¸ ì•„ì´ì½˜ ìƒì„± ì‹œë„');
            createYouTubeIcon();
        }, 2000);
        
        // 5ì´ˆ í›„ì—ë„ í•œ ë²ˆ ë” ì‹œë„
        setTimeout(() => {
            debugLog('ì„¸ ë²ˆì§¸ ì•„ì´ì½˜ ìƒì„± ì‹œë„');
            createYouTubeIcon();
        }, 5000);
        
        debugLog('ìŠ¤í¬ë¦½íŠ¸ ë¡œë“œ ì™„ë£Œ');
    </script>
</body>
</html>
